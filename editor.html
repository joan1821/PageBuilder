<!DOCTYPE html>
<html>
<head>
  <title>JSON Page Editor</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 1rem; }
    textarea { width: 100%; height: 300px; font-family: monospace; }
    input, button { margin: 0.5rem 0; padding: 0.5rem; width: 100%; }
    label { font-weight: bold; margin-top: 1rem; display: block; }
  </style>
</head>
<body>
  <h1>JSON Page Editor</h1>

  <label for="username">GitHub Username</label>
  <input type="text" id="username" placeholder="e.g. johndoe" />

  <label for="repo">Repository Name</label>
  <input type="text" id="repo" placeholder="e.g. my-json-site" />

  <label for="token">GitHub Token</label>
  <input type="password" id="token" placeholder="GitHub Personal Access Token (keep private!)" />

  <label for="jsonInput">JSON Content (must include a 'content' field)</label>
  <textarea id="jsonInput">{
  "content": "<!DOCTYPE html><html><head><title>Hello</title></head><body><h1>Hello from Editor!</h1></body></html>"
}</textarea>

  <button onclick="submitJSON()">Submit and Commit</button>

  <script>
    async function submitJSON() {
      const username = document.getElementById('username').value.trim();
      const repo = document.getElementById('repo').value.trim();
      const token = document.getElementById('token').value.trim();
      const jsonText = document.getElementById('jsonInput').value;

      if (!username || !repo || !token || !jsonText) {
        alert("Please fill out all fields.");
        return;
      }

      const filePath = 'page.json';
      const branch = 'main';
      const base64Content = btoa(unescape(encodeURIComponent(jsonText)));

      try {
        // Get SHA of current file
        const shaRes = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${filePath}`, {
          headers: {
            Authorization: `token ${token}`,
            Accept: 'application/vnd.github.v3+json'
          }
        });

        const shaData = await shaRes.json();
        const sha = shaData.sha;

        // Commit updated file
        const commitRes = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${filePath}`, {
          method: 'PUT',
          headers: {
            Authorization: `token ${token}`,
            Accept: 'application/vnd.github.v3+json'
          },
          body: JSON.stringify({
            message: 'Update page.json via editor',
            content: base64Content,
            sha: sha,
            branch: branch
          })
        });

        if (!commitRes.ok) {
          const errorData = await commitRes.json();
          console.error(errorData);
          throw new Error(errorData.message || "Unknown error");
        }

        alert("✅ Commit successful! GitHub Pages will update shortly.");
      } catch (err) {
        alert("❌ Error: " + err.message);
      }
    }
  </script>
</body>
</html>
